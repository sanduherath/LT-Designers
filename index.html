<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LT Designers</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .toggle-btn {
        transition: all 0.3s ease;
      }
      .cart-scroll::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 10px;
      }
      .cart-scroll::-webkit-scrollbar-thumb:hover {
        background: #555;
      }
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
    <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
      <!-- Breadcrumb omitted for brevity -->

      <div class="px-6 pb-4">
        <div class="max-w-7xl mx-auto">
          <div
            class="bg-white rounded-2xl shadow-lg overflow-hidden border border-gray-200"
          >
            <!-- Toggle Buttons -->
            <div class="p-4 pb-0">
              <div class="flex gap-2 sm:gap-4 mb-4">
                <button
                  id="autoBtn"
                  class="toggle-btn flex-1 bg-blue-900 text-white py-2 sm:py-3 px-3 sm:px-6 rounded-lg font-semibold shadow-lg text-xs sm:text-base transition-all"
                >
                  Automation Calculations
                </button>
                <button
                  id="manualBtn"
                  class="toggle-btn flex-1 bg-gray-300 text-gray-700 py-2 sm:py-3 px-3 sm:px-6 rounded-lg font-semibold text-xs sm:text-base transition-all"
                >
                  Manual Calculations
                </button>
              </div>
            </div>

            <div class="p-4">
              <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                <!-- Automation Calculations Form -->
                <div
                  id="autoForm"
                  class="lg:col-span-2 border-2 border-blue-900 rounded-xl p-4"
                >
                  <h2
                    class="text-lg sm:text-xl lg:text-2xl font-bold mb-4 text-center text-gray-800"
                  >
                    Automation Calculations
                  </h2>

                  <div class="form-scroll space-y-3">
                    <!-- Frame (select from presets) -->
                    <div>
                      <label
                        class="block text-sm font-semibold text-gray-700 mb-2"
                        >Select Frame</label
                      >
                      <select
                        id="autoFrame"
                        class="w-full px-3 py-2 border-2 border-blue-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium"
                      >
                        <option value="">Select Frame</option>
                        <!-- 9*12 frame option removed per request -->
                        <option value="550">
                          15*12 Wooden Frame - Rs. 550.00
                        </option>
                        <option value="650">
                          18*15 Wooden Frame - Rs. 650.00
                        </option>
                        <option value="700">
                          18*22 Wooden Frame - Rs. 700.00
                        </option>
                      </select>
                    </div>

                    <!-- Mesh Type -->
                    <div>
                      <label
                        class="block text-sm font-semibold text-gray-700 mb-2"
                        >Select Mesh Type</label
                      >
                      <div class="flex gap-4">
                        <button
                          id="autoPVC"
                          class="flex-1 py-2 px-3 rounded-lg bg-blue-900 text-white font-semibold text-sm transition-all"
                        >
                          PVC
                        </button>
                        <button
                          id="autoWaterbase"
                          class="flex-1 py-2 px-3 rounded-lg bg-gray-300 text-gray-700 font-semibold text-sm transition-all"
                        >
                          WaterBase
                        </button>
                      </div>
                    </div>

                    <!-- Mesh Options (populated per PVC/WaterBase) -->
                    <div>
                      <label
                        class="block text-sm font-semibold text-gray-700 mb-2"
                        >Select Mesh</label
                      >
                      <select
                        id="autoMeshOption"
                        class="w-full px-3 py-2 border-2 border-blue-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium"
                      >
                        <option value="">Select Mesh Option</option>
                      </select>
                    </div>

                    <!-- Hidden Mesh Price -->
                    <input type="hidden" id="autoMeshPrice" value="0" />

                    <!-- Stretching (select) -->
                    <div>
                      <label
                        class="block text-sm font-semibold text-gray-700 mb-2"
                        >Select Stretching</label
                      >
                      <select
                        id="autoStretching"
                        class="w-full px-3 py-2 border-2 border-blue-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium"
                      >
                        <option value="0">Select Stretching</option>
                        <option value="400">9*12 Streching - Rs. 400.00</option>
                        <option value="400">
                          15*12 Streching - Rs. 400.00
                        </option>
                        <option value="450">
                          18*15 Streching - Rs. 450.00
                        </option>
                        <option value="450">
                          18*22 Streching - Rs. 450.00
                        </option>
                      </select>
                    </div>

                    <!-- Exposin (select) -->
                    <div>
                      <label
                        class="block text-sm font-semibold text-gray-700 mb-2"
                        >Select Exposin</label
                      >
                      <select
                        id="autoExposin"
                        class="w-full px-3 py-2 border-2 border-blue-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium"
                      >
                        <option value="">Select Exposin</option>
                        <option value="850">9*12 Exposin - Rs. 850.00</option>
                        <option value="1275">
                          15*12 Exposin - Rs. 1275.00
                        </option>
                        <option value="1530">
                          18*15 Exposin - Rs. 1530.00
                        </option>
                        <option value="1700">
                          18*22 Exposin - Rs. 1700.00
                        </option>
                      </select>
                    </div>

                    <!-- Hardener (select) -->
                    <div>
                      <label
                        class="block text-sm font-semibold text-gray-700 mb-2"
                        >Select Hardener</label
                      >
                      <select
                        id="autoHardener"
                        class="w-full px-3 py-2 border-2 border-blue-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium"
                      >
                        <option value="0">None / Select Hardener</option>
                        <option value="400">9*12 Hardner - Rs. 400.00</option>
                        <option value="450">15*12 Hardner - Rs. 450.00</option>
                        <option value="450">18*15 Hardner - Rs. 450.00</option>
                        <option value="450">18*22 Hardner - Rs. 450.00</option>
                      </select>
                    </div>

                    <!-- Total Price -->
                    <div>
                      <label
                        class="block text-sm font-semibold text-gray-700 mb-2"
                        >Total Price (LKR)</label
                      >
                      <input
                        type="text"
                        id="autoTotal"
                        readonly
                        class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg bg-gray-100 text-sm font-bold"
                        value="0.00"
                      />
                    </div>

                    <!-- Add Cart Button -->
                    <button
                      id="autoAddCart"
                      class="w-full bg-blue-900 hover:bg-blue-800 text-white py-2 sm:py-3 rounded-lg font-semibold transition-all shadow-lg text-sm sm:text-base"
                    >
                      Add to Cart
                    </button>
                  </div>
                </div>

                <!-- Manual Calculations Form -->
                <div
                  id="manualForm"
                  class="lg:col-span-2 border-2 border-blue-900 rounded-xl p-4 hidden"
                >
                  <h2
                    class="text-lg sm:text-xl lg:text-2xl font-bold mb-4 text-center text-gray-800"
                  >
                    Manual Calculations
                  </h2>

                  <div class="form-scroll grid grid-cols-2 gap-3">
                    <!-- Width & Height -->
                    <div>
                      <label
                        class="block text-sm font-semibold text-gray-700 mb-2"
                        >Width</label
                      >
                      <input
                        type="number"
                        id="manualWidth"
                        placeholder="Enter Width"
                        class="w-full px-3 py-2 border-2 border-blue-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium"
                      />
                    </div>
                    <div>
                      <label
                        class="block text-sm font-semibold text-gray-700 mb-2"
                        >Height</label
                      >
                      <input
                        type="number"
                        id="manualHeight"
                        placeholder="Enter Height"
                        class="w-full px-3 py-2 border-2 border-blue-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium"
                      />
                    </div>

                    <!-- Frame -->
                    <div class="col-span-2">
                      <label
                        class="block text-sm font-semibold text-gray-700 mb-2"
                        >Frame</label
                      >
                      <input
                        type="number"
                        id="manualFrame"
                        placeholder="Enter Frame Price"
                        class="w-full px-3 py-2 border-2 border-blue-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium"
                      />
                    </div>

                    <!-- Mesh Type -->
                    <div class="col-span-2">
                      <label
                        class="block text-sm font-semibold text-gray-700 mb-2"
                        >Select Mesh Type</label
                      >
                      <div class="flex gap-4">
                        <button
                          id="manualPVC"
                          class="flex-1 py-2 px-3 rounded-lg bg-blue-900 text-white font-semibold text-sm transition-all"
                        >
                          PVC
                        </button>
                        <button
                          id="manualWaterbase"
                          class="flex-1 py-2 px-3 rounded-lg bg-gray-300 text-gray-700 font-semibold text-sm transition-all"
                        >
                          Waterbase
                        </button>
                      </div>
                    </div>

                    <!-- Mesh Price (manual entry) -->
                    <div class="col-span-2">
                      <label
                        class="block text-sm font-semibold text-gray-700 mb-2"
                        >Mesh Price</label
                      >
                      <input
                        type="number"
                        id="manualMeshPrice"
                        placeholder="Enter Mesh Price"
                        class="w-full px-3 py-2 border-2 border-blue-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium"
                      />
                    </div>

                    <!-- (Manual mesh size selection removed - mesh price is entered manually) -->

                    <!-- Other Fields -->
                    <div class="col-span-2">
                      <label
                        class="block text-sm font-semibold text-gray-700 mb-2"
                        >Stretching</label
                      >
                      <input
                        type="number"
                        id="manualStretching"
                        placeholder="Enter Stretching Price"
                        class="w-full px-3 py-2 border-2 border-blue-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium"
                      />
                    </div>

                    <div class="col-span-2">
                      <label
                        class="block text-sm font-semibold text-gray-700 mb-2"
                        >Exposin</label
                      >
                      <input
                        type="number"
                        id="manualExposin"
                        placeholder="Enter Exposin Price"
                        class="w-full px-3 py-2 border-2 border-blue-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium"
                      />
                    </div>

                    <div class="col-span-2">
                      <label
                        class="block text-sm font-semibold text-gray-700 mb-2"
                        >Hardener</label
                      >
                      <input
                        type="number"
                        id="manualHardener"
                        placeholder="Enter Hardener Price"
                        class="w-full px-3 py-2 border-2 border-blue-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium"
                      />
                    </div>

                    <div class="col-span-2">
                      <label
                        class="block text-sm font-semibold text-gray-700 mb-2"
                        >Washing</label
                      >
                      <input
                        type="number"
                        id="manualWashing"
                        placeholder="Enter Washing Price"
                        class="w-full px-3 py-2 border-2 border-blue-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium"
                      />
                    </div>

                    <!-- Total Price -->
                    <div class="col-span-2">
                      <label
                        class="block text-sm font-semibold text-gray-700 mb-2"
                        >Total Price (LKR)</label
                      >
                      <input
                        type="text"
                        id="manualTotal"
                        readonly
                        class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg bg-gray-100 text-sm font-bold"
                        value="0.00"
                      />
                    </div>

                    <!-- Add Cart Button -->
                    <div class="col-span-2">
                      <button
                        id="manualAddCart"
                        class="w-full bg-blue-900 hover:bg-blue-800 text-white py-2 sm:py-3 rounded-lg font-semibold transition-all shadow-lg text-sm sm:text-base"
                      >
                        Add to Cart
                      </button>
                    </div>
                  </div>
                </div>

                <!-- Cart Items Section -->
                <div class="lg:col-span-1">
                  <div
                    class="bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 border border-gray-200"
                  >
                    <h3
                      class="text-base sm:text-lg font-bold mb-3 text-center text-gray-800"
                    >
                      Cart Items
                    </h3>
                    <div
                      id="cartItems"
                      class="cart-scroll space-y-3 max-h-96 overflow-y-auto"
                    >
                      <p class="text-center text-gray-500 text-sm py-8">
                        No items in cart
                      </p>
                    </div>
                  </div>
                  <div
                    class="mt-4 text-center bg-gradient-to-r from-blue-900 to-indigo-900 rounded-lg p-3 shadow-lg"
                  >
                    <p
                      class="text-lg sm:text-xl lg:text-2xl font-bold text-white"
                    >
                      Total: Rs <span id="totalPrice">0.00</span>
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // --- Price Data ---
      // Frame options are in the HTML select

      // Mesh option lists for PVC and WaterBase (label -> price)
      const meshOptions = {
        PVC: [
          { label: "PVC Mesh 15×12 - Rs. 850.00", price: 850 },
          { label: "PVC Mesh 18×15 - Rs. 1200.00", price: 1200 },
          { label: "PVC Mesh 18×22 - Rs. 1650.00", price: 1650 },
        ],
        WaterBase: [
          { label: "WaterBase Mesh 15×12 - Rs. 350.00", price: 350 },
          { label: "WaterBase Mesh 18×15 - Rs. 750.00", price: 750 },
          { label: "WaterBase Mesh 18×22 - Rs. 1000.00", price: 1000 },
        ],
      };

      let cartItems = [];
      let currentMode = "auto";
      let autoMeshType = "PVC";
      let manualMeshType = "PVC";

      // --- Mode Toggle ---
      document.getElementById("autoBtn").addEventListener("click", () => {
        currentMode = "auto";
        document.getElementById("autoForm").classList.remove("hidden");
        document.getElementById("manualForm").classList.add("hidden");
        document
          .getElementById("autoBtn")
          .classList.add("bg-blue-900", "text-white");
        document
          .getElementById("autoBtn")
          .classList.remove("bg-gray-300", "text-gray-700");
        document
          .getElementById("manualBtn")
          .classList.add("bg-gray-300", "text-gray-700");
        document
          .getElementById("manualBtn")
          .classList.remove("bg-blue-900", "text-white");
      });

      document.getElementById("manualBtn").addEventListener("click", () => {
        currentMode = "manual";
        document.getElementById("manualForm").classList.remove("hidden");
        document.getElementById("autoForm").classList.add("hidden");
        document
          .getElementById("manualBtn")
          .classList.add("bg-blue-900", "text-white");
        document
          .getElementById("manualBtn")
          .classList.remove("bg-gray-300", "text-gray-700");
        document
          .getElementById("autoBtn")
          .classList.add("bg-gray-300", "text-gray-700");
        document
          .getElementById("autoBtn")
          .classList.remove("bg-blue-900", "text-white");
      });

      // --- Mesh Type Toggle ---
      document.getElementById("autoPVC").addEventListener("click", () => {
        autoMeshType = "PVC";
        populateMeshOptions();
        toggleMeshButton("PVC");
      });
      document.getElementById("autoWaterbase").addEventListener("click", () => {
        autoMeshType = "WaterBase";
        populateMeshOptions();
        toggleMeshButton("WaterBase");
      });
      // --- Manual Mesh Type Toggle (wire up) ---
      document.getElementById("manualPVC").addEventListener("click", () => {
        manualMeshType = "PVC";
        document
          .getElementById("manualPVC")
          .classList.add("bg-blue-900", "text-white");
        document
          .getElementById("manualPVC")
          .classList.remove("bg-gray-300", "text-gray-700");
        document
          .getElementById("manualWaterbase")
          .classList.add("bg-gray-300", "text-gray-700");
        document
          .getElementById("manualWaterbase")
          .classList.remove("bg-blue-900", "text-white");
        populateManualMeshOptions();
      });
      document
        .getElementById("manualWaterbase")
        .addEventListener("click", () => {
          manualMeshType = "WaterBase";
          document
            .getElementById("manualWaterbase")
            .classList.add("bg-blue-900", "text-white");
          document
            .getElementById("manualWaterbase")
            .classList.remove("bg-gray-300", "text-gray-700");
          document
            .getElementById("manualPVC")
            .classList.add("bg-gray-300", "text-gray-700");
          document
            .getElementById("manualPVC")
            .classList.remove("bg-blue-900", "text-white");
          populateManualMeshOptions();
        });
      function toggleMeshButton(type) {
        if (type === "PVC") {
          document
            .getElementById("autoPVC")
            .classList.add("bg-blue-900", "text-white");
          document
            .getElementById("autoPVC")
            .classList.remove("bg-gray-300", "text-gray-700");
          document
            .getElementById("autoWaterbase")
            .classList.add("bg-gray-300", "text-gray-700");
          document
            .getElementById("autoWaterbase")
            .classList.remove("bg-blue-900", "text-white");
        } else {
          document
            .getElementById("autoWaterbase")
            .classList.add("bg-blue-900", "text-white");
          document
            .getElementById("autoWaterbase")
            .classList.remove("bg-gray-300", "text-gray-700");
          document
            .getElementById("autoPVC")
            .classList.add("bg-gray-300", "text-gray-700");
          document
            .getElementById("autoPVC")
            .classList.remove("bg-blue-900", "text-white");
        }
      }

      // --- Populate Mesh Options based on mesh type ---
      function populateMeshOptions() {
        const sel = document.getElementById("autoMeshOption");
        sel.innerHTML = '<option value="">Select Mesh Option</option>';
        meshOptions[autoMeshType].forEach((opt) => {
          const o = document.createElement("option");
          o.value = opt.price;
          o.textContent = opt.label;
          sel.appendChild(o);
        });
        // reset mesh price
        document.getElementById("autoMeshPrice").value = 0;
        calculateAutoTotal();
      }

      // --- Populate Manual Mesh Options ---
      function populateManualMeshOptions() {
        // For manual mode we allow direct entry of mesh price. Reset the mesh price input.
        const mp = document.getElementById("manualMeshPrice");
        if (mp) mp.value = "";
        // manual mesh size removed; nothing to reset here
        calculateManualTotal();
      }

      // manual mesh size selection removed; manual price entry is used instead

      // wire mesh option change to update hidden price and total
      document
        .getElementById("autoMeshOption")
        .addEventListener("change", () => {
          const price =
            parseFloat(document.getElementById("autoMeshOption").value) || 0;
          document.getElementById("autoMeshPrice").value = price;
          calculateAutoTotal();
        });

      // populate default mesh options on load (default to PVC)
      window.addEventListener("DOMContentLoaded", () => {
        autoMeshType = "PVC";
        toggleMeshButton("PVC");
        populateMeshOptions();
      });

      // --- Track User Inputs for Total ---
      ["autoFrame", "autoStretching", "autoExposin", "autoHardener"].forEach(
        (id) => {
          const el = document.getElementById(id);
          if (!el) return;
          el.addEventListener("input", () => {
            el.dataset.userEdited = true;
            calculateAutoTotal();
          });
          el.addEventListener("change", () => calculateAutoTotal());
        }
      );

      function calculateAutoTotal() {
        const frame =
          parseFloat(document.getElementById("autoFrame").value) || 0;
        const mesh =
          parseFloat(document.getElementById("autoMeshPrice").value) || 0;
        const stretching =
          parseFloat(document.getElementById("autoStretching").value) || 0;
        const exposin =
          parseFloat(document.getElementById("autoExposin").value) || 0;
        const hardener =
          parseFloat(document.getElementById("autoHardener").value) || 0;
        const total = frame + mesh + stretching + exposin + hardener;
        document.getElementById("autoTotal").value = total.toFixed(2);
      }

      // --- Add to Cart ---
      document.getElementById("autoAddCart").addEventListener("click", () => {
        const frameSelect = document.getElementById("autoFrame");
        const frameValue = parseFloat(frameSelect.value) || 0;
        const frameLabel =
          frameSelect.options[frameSelect.selectedIndex]?.text || "";

        const meshSelect = document.getElementById("autoMeshOption");
        const meshPrice = parseFloat(meshSelect.value) || 0;
        const meshLabel =
          meshSelect.options[meshSelect.selectedIndex]?.text || "";

        const stretching =
          parseFloat(document.getElementById("autoStretching").value) || 0;
        const exposinSelect = document.getElementById("autoExposin");
        const exposin = parseFloat(exposinSelect.value) || 0;
        const exposinLabel =
          exposinSelect.options[exposinSelect.selectedIndex]?.text || "";

        const hardenerSelect = document.getElementById("autoHardener");
        const hardener = parseFloat(hardenerSelect.value) || 0;
        const hardenerLabel =
          hardenerSelect.options[hardenerSelect.selectedIndex]?.text || "";

        const total =
          parseFloat(document.getElementById("autoTotal").value) || 0;

        if (!meshLabel) {
          alert("Please select a Mesh option!");
          return;
        }

        // create a short mesh label without the trailing price (e.g. remove " - Rs ...")
        const meshLabelShort = meshLabel
          .replace(/\s*-\s*Rs\.?\s*.*/i, "")
          .trim();

        const item = {
          frameValue,
          frameLabel,
          meshPrice,
          meshLabel,
          meshLabelShort,
          meshType: autoMeshType,
          stretching,
          exposin,
          exposinLabel,
          hardener,
          hardenerLabel,
          total,
          id: "item_" + Date.now() + "_" + Math.random().toString(36).slice(2),
          mode: "auto",
        };
        cartItems.push(item);
        renderCart();
        // Reset automation form fields after adding to cart
        document.getElementById("autoFrame").value = "";
        document.getElementById("autoMeshOption").selectedIndex = 0;
        document.getElementById("autoMeshPrice").value = 0;
        document.getElementById("autoStretching").value = "0";
        document.getElementById("autoExposin").selectedIndex = 0;
        document.getElementById("autoHardener").value = "0";
        document.getElementById("autoTotal").value = "0.00";
      });

      // --- Manual calculation and Add to Cart ---
      function calculateManualTotal() {
        const frame =
          parseFloat(document.getElementById("manualFrame").value) || 0;
        const mesh =
          parseFloat(document.getElementById("manualMeshPrice")?.value) || 0;
        const stretching =
          parseFloat(document.getElementById("manualStretching").value) || 0;
        const exposin =
          parseFloat(document.getElementById("manualExposin").value) || 0;
        const hardener =
          parseFloat(document.getElementById("manualHardener").value) || 0;
        const washing =
          parseFloat(document.getElementById("manualWashing").value) || 0;
        const total = frame + mesh + stretching + exposin + hardener + washing;
        document.getElementById("manualTotal").value = total.toFixed(2);
      }

      // wire manual inputs
      [
        "manualFrame",
        "manualMeshPrice",
        "manualStretching",
        "manualExposin",
        "manualHardener",
        "manualWashing",
        "manualWidth",
        "manualHeight",
      ].forEach((id) => {
        const el = document.getElementById(id);
        if (!el) return;
        el.addEventListener("input", calculateManualTotal);
        el.addEventListener("change", calculateManualTotal);
      });

      // manual mesh price input is handled directly by input listeners (wired below)

      document.getElementById("manualAddCart").addEventListener("click", () => {
        const frameValue =
          parseFloat(document.getElementById("manualFrame").value) || 0;
        // store a simple frame label (no price) for manual items; if user entered a frame price, we still keep the numeric value in frameValue
        const frameLabel = frameValue ? `Frame` : "";
        const meshPrice =
          parseFloat(document.getElementById("manualMeshPrice")?.value) || 0;
        // infer mesh size/label: prefer user-entered width/height if provided, otherwise try to match by known meshOptions prices
        let inferredSize = "";
        const w = document.getElementById("manualWidth")?.value;
        const h = document.getElementById("manualHeight")?.value;
        if (w && h) {
          inferredSize = `${w}×${h}`;
        } else if (meshPrice > 0) {
          const opts = meshOptions[manualMeshType] || [];
          const match = opts.find((o) => parseFloat(o.price) === meshPrice);
          if (match) {
            // extract size portion from label like 'PVC Mesh 15×12 - Rs. 850.00'
            inferredSize = (match.label || "")
              .replace(/^.*?Mesh\s*/i, "")
              .replace(/\s*-.*$/, "")
              .trim();
          }
        }
        const meshLabelShort = inferredSize
          ? `${manualMeshType} Mesh ${inferredSize}`
          : `${manualMeshType} Mesh`;
        const meshLabel = `${meshLabelShort} - Rs ${meshPrice.toFixed(2)}`;
        const stretching =
          parseFloat(document.getElementById("manualStretching").value) || 0;
        const exposin =
          parseFloat(document.getElementById("manualExposin").value) || 0;
        const hardener =
          parseFloat(document.getElementById("manualHardener").value) || 0;
        const washing =
          parseFloat(document.getElementById("manualWashing").value) || 0;
        const width = document.getElementById("manualWidth").value || null;
        const height = document.getElementById("manualHeight").value || null;
        const total =
          parseFloat(document.getElementById("manualTotal").value) || 0;

        if (total <= 0) {
          alert("Please enter values for manual item");
          return;
        }

        const item = {
          frameValue,
          frameLabel,
          meshPrice,
          meshLabel,
          meshLabelShort,
          meshType: manualMeshType,
          stretching,
          exposin,
          hardener,
          washing,
          width,
          height,
          total,
          id: "item_" + Date.now() + "_" + Math.random().toString(36).slice(2),
          mode: "manual",
        };
        cartItems.push(item);
        renderCart();
        // Reset manual form fields after adding to cart
        document.getElementById("manualFrame").value = "";
        const mh = document.getElementById("manualMeshPrice");
        if (mh) mh.value = "";
        const ms = document.getElementById("manualMeshSize");
        if (ms) ms.selectedIndex = 0;
        document.getElementById("manualStretching").value = "";
        document.getElementById("manualExposin").value = "";
        document.getElementById("manualHardener").value = "";
        document.getElementById("manualWashing").value = "";
        document.getElementById("manualWidth").value = "";
        document.getElementById("manualHeight").value = "";
        document.getElementById("manualTotal").value = "0.00";
      });

      function renderCart() {
        const cartEl = document.getElementById("cartItems");
        cartEl.innerHTML = "";
        if (cartItems.length === 0) {
          cartEl.innerHTML =
            '<p class="text-center text-gray-500 text-sm py-8">No items in cart</p>';
          // ensure displayed total is zero when cart is empty
          document.getElementById("totalPrice").innerText = "0.00";
        } else {
          let grandTotal = 0;
          cartItems.forEach((item, i) => {
            grandTotal += parseFloat(item.total || 0);
            const div = document.createElement("div");
            div.className =
              "border rounded-lg p-3 bg-white flex flex-col gap-2 shadow-sm";
            // Title: for manual mode show only meshLabelShort (e.g., "PVC Mesh 9×12"), for auto show frame + mesh
            // create an item badge like Item 01, Item 02 (purple pill similar to the provided image)
            const idxLabel = `Item ${i + 1}`;
            const titleTop = `<div class="flex items-center gap-2"><span class="inline-block bg-indigo-600 text-white rounded-full px-3 py-1 text-xs">${idxLabel}</span></div>`;

            // build rows only for non-zero price components
            let rows = "";
            const fv = parseFloat(item.frameValue || 0);
            const mp = parseFloat(item.meshPrice || 0);
            const st = parseFloat(item.stretching || 0);
            const ex = parseFloat(item.exposin || 0);
            const hd = parseFloat(item.hardener || 0);
            const ws = parseFloat(item.washing || 0);

            // Build rows: left label, right value (only Total shows 'Rs')
            if (fv > 0)
              rows += `<div>Frame</div><div class="text-right">${fv.toFixed(
                2
              )}</div>`;
            if (mp > 0) {
              const mcat =
                item.meshType ||
                (item.meshLabelShort || "").split(" ")[0] ||
                "";
              rows += `<div>Mesh Type <span class="text-sm text-gray-600">(${mcat})</span></div><div class="text-right">${mp.toFixed(
                2
              )}</div>`;
            }
            if (st > 0)
              rows += `<div>Stretching</div><div class="text-right">${st.toFixed(
                2
              )}</div>`;
            if (ex > 0)
              rows += `<div>Exposin</div><div class="text-right">${ex.toFixed(
                2
              )}</div>`;
            if (hd > 0)
              rows += `<div>Hardener</div><div class="text-right">${hd.toFixed(
                2
              )}</div>`;
            if (ws > 0)
              rows += `<div>Washing</div><div class="text-right">${ws.toFixed(
                2
              )}</div>`;
            if (item.mode !== "manual" && item.width && item.height)
              rows += `<div>Dimensions</div><div class="text-right">${item.width} × ${item.height}</div>`;

            // Always show Total (with Rs)
            rows += `<div class="font-bold">Total</div><div class="text-right font-bold">Rs ${parseFloat(
              item.total || 0
            ).toFixed(2)}</div>`;

            div.innerHTML =
              `
          <div class="flex justify-between items-center">
              ${titleTop}
              <button class="text-red-500 font-bold" onclick="removeItemById('${item.id}')">X</button>
          </div>
          <div class="text-sm text-gray-700 grid grid-cols-2 gap-1">` +
              rows +
              `</div>`;
            cartEl.appendChild(div);
          });
          document.getElementById("totalPrice").innerText =
            grandTotal.toFixed(2);
        }
        // Safety: if there are somehow no items set total to 0.00
        if (!cartItems || cartItems.length === 0) {
          document.getElementById("totalPrice").innerText = "0.00";
        }
      }

      window.removeItem = function (index) {
        cartItems.splice(index, 1);
        renderCart();
      };

      // Remove an item by its unique id and update cart
      window.removeItemById = function (id) {
        const idx = cartItems.findIndex((i) => i.id === id);
        if (idx !== -1) {
          cartItems.splice(idx, 1);
          renderCart();
        }
      };
    </script>
  </body>
</html>
